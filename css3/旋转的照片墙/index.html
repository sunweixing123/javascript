<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>index</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        body,html{
            width: 100%;
            height: 100%;
        }
        #container{
            width: 100%;
            height: 100%;
            background: url("img/bg.jpg");
            position: relative;
        }
        #container .img{
            width: 125px;
            height: 125px;
            border: 5px solid #fff;
            box-shadow: 2px 2px 2px 2px rgba(0, 0, 0, 0.5);
            position: absolute;
            top: -500px;
            left: -500px;
            transition: all 1s ease;
            cursor: pointer;
        }
        #container .img span{
            width: 100%;
            height: 100%;
            opacity: 0;
            display: block;
            transition: all 1s ease;
        }
        #prev,#next{
            width: 60px;
            height: 60px;
            background: #fff no-repeat center;
            position: absolute;
            top: 50%;
            margin-top: -30px;
            display: none;
            cursor: pointer;

        }
        #prev{
            background-image: url('img/prev.png');
            left: 0;
        }
        #next{
            background-image: url("img/next.png");
            right: 0;
        }

    </style>
</head>
<body>
<div id="container">

</div>
<div id="prev"></div>
<div id="next"></div>
<script>
    const row=4,
    col=6,
    num=row*col,
    big_width=750,
    big_height=500,
    thumb_width=125,
    thumb_height=125;
    let count=0;
    let ocontainer=document.getElementById('container');
    let aImg=null;
    let nowindex=0;
    let oprev=document.getElementById('prev');
    let onext=document.getElementById("next");
    for(let i=0;i<num;i++) {
        let othumbsimg = new Image();
        othumbsimg.onload = function () {
            count++;
            if (count == num * 2) {
                loadsuccess();
            }
        };
        othumbsimg.src = 'img/thumbs/' + (i + 1) + '.jpg';
        let obigimg = new Image();
        obigimg.onload = function () {
            count++;
            if (count == num * 2) {
                loadsuccess();
            }
        };
        obigimg.src = 'img/' + (i + 1) + '.jpg';
    }
        function loadsuccess() {
            for (let i = 0; i < row; i++) {
                for (let j = 0; j < col; j++) {
                    let odiv = document.createElement('div');
                    odiv.style.background = 'url(img/thumbs/' + (i * col + j + 1) + '.jpg) no-repeat';
                    odiv.className = 'img';
                    odiv.pos = {
                        x: j,
                        y: i
                    };
                    odiv.index = i * col + j + 1;
                    odiv.innerHTML = '<span></span>';
                    ocontainer.appendChild(odiv);
                }
            }


            aImg = ocontainer.getElementsByTagName('div');
            colGap = (ocontainer.offsetWidth - aImg[0].offsetWidth * col) / (col + 1);
            rowGap = (ocontainer.offsetHeight - aImg[0].offsetHeight * row) / (row + 1);
            for (let i = 0; i < num; i++) {
//            aImg[i].style.transform='rotate(' + Math.floor(Math.random()*40-20) + 'deg)';
//            aImg[i].style.transitionDelay=(num-i)*100+'ms';
//            aImg[i].style.top=(rowGap+aImg[0].offsetHeight)*aImg[i].pos.y+rowGap+'px';
//            aImg[i].style.left=(colGap+aImg[0].offsetWidth)*aImg[i].pos.x+colGap+'px';

                aImg[i].style.transform = 'rotate(' + Math.floor(Math.random() * 40 - 20) + 'deg)';
                aImg[i].style.transitionDelay = (num - i) * 100 + 'ms';// 设置延迟时间
                aImg[i].style.top = (rowGap + aImg[0].offsetHeight) * aImg[i].pos.y + rowGap + 'px';
                aImg[i].style.left = (colGap + aImg[0].offsetWidth) * aImg[i].pos.x + colGap + 'px';

            }
        }
//计算大图片


            let bigColGap = (ocontainer.offsetWidth - big_width) / 2,
                bigRowGap = (ocontainer.offsetHeight - big_height) / 2;
            let bFlag = true;
            ocontainer.onclick = function (e) {
                // e.target => oContainer/div/span
                if (e.currentTarget != e.target) {
                    if (bFlag) {
                        for (let i = 0; i < num; i++) {
                            aImg[i].style.transitionDelay = '0ms';
                            aImg[i].style.borderWidth = '1px';
                            aImg[i].style.top = bigRowGap + thumb_height * aImg[i].pos.y + 'px';
                            aImg[i].style.left = bigColGap + thumb_width * aImg[i].pos.x + 'px';
                            aImg[i].style.transform = 'rotate(0deg)';

                            let oSpan = aImg[i].getElementsByTagName('span')[0];
                            oSpan.style.opacity = 1;
                            let imgUrl;
                            if (e.target.tagName == 'DIV') {
                                imgUrl = e.target.index;
                            } else { // span
                                imgUrl = e.target.parentNode.index;
                            }
                            oSpan.style.backgroundImage = 'url(img/' + imgUrl + '.jpg)';
                            oSpan.style.backgroundPosition = -thumb_width* aImg[i].pos.x + 'px ' + (-thumb_height * aImg[i].pos.y) + 'px';
//                            oSpan.style.transitionDelay='0ms';
                        }
                        oprev.style.display=onext.style.display='block';
                    }

//            let bigColGap=(ocontainer.offsetWidth - big_width)/2,
//             bigRowGap=(ocontainer.offsetHeight-big_height)/2;
//           let bFlag = true;
//            ocontainer.onclick = function (e) {
//                if (e.currentTarget != e.target) {
//                    if (bFlag) {
//                        for (let i = 0; i < num; i++) {
//                            aImg[i].style.transitionDelay = '0ms';
//                            aImg[i].style.borderWidth = '1px';
//                            aImg[i].style.top = bigRowGap + thumb_height * aImg[i].pos.y + 'px';
//                            aImg[i].style.left = bigColGap + thumb_width * aImg[i].pos.x + 'px';
//                            aImg[i].style.transform = 'rotate(0deg)';
//                            let ospan = aImg[i].getElementsByTagName('span')[0];
//                            ospan.style.opacity = 1;
//                            let imgurl;
//                            if (e.target.tagName == 'DIV') {
//                                imgurl = e.target.index;
//                            } else {
//                                imgurl = e.target.parentNode.index;
//                            }
//                            ospan.style.backgroundImage = 'url(img/' + imgurl + '.jpg)';
//                            ospan.style.backgroundPosition = -thumb_width * aImg[i].pos.x + 'px' + (-thumb_height * aImg[i].pos.y) + 'px';
//                        }
//
//                    }

                    else {
                        for(let i=0;i<num;i++){
                            aImg[i].style.transform = 'rotate(' + Math.floor(Math.random() * 40 - 20) + 'deg)';
                            aImg[i].style.transitionDelay = '0ms';// 设置延迟时间
                            aImg[i].style.top = (rowGap + aImg[0].offsetHeight) * aImg[i].pos.y + rowGap + 'px';
                            aImg[i].style.left = (colGap + aImg[0].offsetWidth) * aImg[i].pos.x + colGap + 'px';
                            let ospan=aImg[i].getElementsByTagName('span')[0];
                            ospan.style.opacity=0;
                            ospan.style.transitionDelay='0ms';

                        }
                        oprev.style.display=onext.style.display='none';
                    }
                    bFlag=!bFlag;
                }
            };
    oprev.onclick = onext.onclick = function () {
        if (this === oprev) {
            nowindex--;
            if (nowindex < 1) {
                nowindex = num;
            }
        } else {
            nowindex++;
            if (nowindex > num) {
                nowindex = 1;
            }
        }
        let arr = [];
        for (let i = 0; i < num; i++) {
            arr.push(i);
        }
        arr.sort(function () {
            return Math.random() - 0.5;
        });
        for (let i = 0; i < arr.length; i++) {
            let oSpan = aImg[arr[i]].getElementsByTagName('span')[0];
            oSpan.style.transitionDelay = i * 50 + 'ms';
            oSpan.style.backgroundImage = 'url(img/' + nowindex + '.jpg)';
        }
    };










</script>
</body>
</html>